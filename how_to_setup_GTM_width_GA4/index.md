
#　グーグルタグマネージャー（以下：GTM）とグーグルアナリティクス４（以下：GA4）を使った設定方法
WordpressのGoogle公式プラグイン「[Site Kit by Google](https://sitekit.withgoogle.com)」を使用する場合は[別の方法](https://www.onamae.com/column/blog/33/)があります。

**プライバシーポリシーについて**
サイト内でアクセス解析をしていることを表記しておく必要があります。
> 当サイトでは、Googleによるアクセス解析ツール「Googleアナリティクス」を使用しています。このGoogleアナリティクスはデータの収集のためにCookieを使用しています。このデータは匿名で収集されており、個人を特定するものではありません。
この機能はCookieを無効にすることで収集を拒否することが出来ますので、お使いのブラウザの設定をご確認ください。この規約に関しての詳細は[Googleアナリティクスサービス利用規約のページ](https://marketingplatform.google.com/about/analytics/terms/jp/)や[Googleポリシーと規約ページ](https://policies.google.com/technologies/ads?hl=ja)をご覧ください。

## GA4の設定

1. [GA4にアクセス](https://analytics.google.com)する。（初めての場合はGoogleアカウントでログイン。 or Googleアカウントを持っていない場合は作成画面になります。）
2. **アカウントを作成** アカウント名を入力。任意のアカウント名を入力しましょう。Googleアカウントは複数作れるため、どのアカウントなのかわかりやすい名称を設定してください。![](1.png)
3. **データ共有オプションの設定** データ共有オプションは説明を読み、特に不要と判断するものがなければ、推奨されている項目にチェックマークを入れます。![](2.png)
4. **GA4プロパティの設定** あとから識別しやすいように任意のプロパティ名を設定し、レポートタイプを「日本」、通貨を「日本円」に設定しましょう。![](3.png)
5. **ウェブサイトのURLを入力** アクセス解析を予定している「ウェブサイトのURL」を入力します。「Googleアナリティクス4とユニバーサルアナリティクスのプロパティの両方を作成する」と「Googleアナリティクス4 プロパティの拡張計測機能を有効にする」が選択されていることを確認してください。![](4.png)
6. **ビジネスの規模と利用目的を選択** ビジネスの規模と、利用目的をチェックして作成をクリックします。ビジネスとしてアナリティクスを使用しない場合は、「小規模 従業員数1〜10名」を選択しておけば問題ありません。![](5.png)
7. **「Googleアナリティクス利用規約」に同意** Googleアナリティクス利用規約がアメリカ合衆国となっていますので、「日本」に設定し、内容を確認の上、「GDPRで必須となるデータ処理規約にも同意します」へチェックを入れましょう。![](6.png)
8. **測定管理者間のデータ保護条項へ同意** 「測定管理者間のデータ保護条項へ同意します」項目にチェックを入れた後、同意するをクリックします。![](7.png)
9. **プロパティの確認と切り替え** まずは画面上部のGoogleアナリティクスロゴ横にある「すべてのウェブサイトのデータ」をクリックし、先ほど作成したプロパティ名を選択します。![](8.png)
10. **「管理」をクリック** 左メニュー下の管理をクリックします。![](9.png)
11. **「データストリーム」をクリック** 次にデータストリームをクリックします。![](10.png)
12. **「Webサイト｣を選択** Googleアナリティクスを設定する「Webサイト」を選択しましょう。![](11.png)
13. **「グローバル サイトタグ（gtag.js）」をクリック** 「グローバル サイトタグ（gtag.js）」をクリックすると、測定 IDが表示されるので、<span id="anchor_1">**控えて**</span>ください。![](12.png)


## <span id="anchor_ga4">GA4の初期設定</span>

### <span id="anchor_ga4_1">自分のアクセス（IPアドレス）を除外</span>

1. **「管理」をクリック**左メニュー下の管理をクリックしましょう。![](13.png)
2. **「データストリーム」をクリック** 次にデータストリームをクリックします。![](14.png)
3. **「Webサイト」を選択** Googleアナリティクスを設定する「Webサイト」を選択しましょう。![](15.png)
4. **「タグ付けの詳細設定」をクリック** 下部にある「タグ付けの詳細設定」をクリックします。![](16.png)
5. **「内部トラフィックの定義」を選択** 右側に作成ボタンがあるのでクリックしましょう。![](17.png)
6. **設定項目を記入** 下記設定項目を入力していきます。
- 「ルール名」には設定内容が把握しやすい名称を入力しましょう。
- マッチタイプは「IPアドレスが次と等しい」へ変更してください。
- 「値」に除外したいIPアドレスを入力してください。
なお、自身のIPアドレスは、たとえば[CMAN](https://www.cman.jp/network/support/go_access.cgi)にアクセスすると画面に大きく表示されますのでご確認ください。![](18.png)

### <span id="anchor_ga4_2">Googleシグナルの設定</span>

1. **「管理」をクリック** 左メニュー下の管理をクリックしましょう。![](19.png)
2. **「データ設定」をクリック** データ設定をクリックしましょう。![](20.png)
3. **「データ収集」をクリック** データ収集をクリックし、利用を開始するを選択します。![](21.png)
4. **「続行」をクリック** 続行をクリックしましょう。![](22.png)
5. **「有効にする」をクリック** 説明を読んで問題がなければ有効にするをクリックしましょう。![](23.png)

#### <span id="anchor_ga4_3">イベントの設定と確認</span>

「イベント」とは、ユーザーがサイトへ訪れ、ページを表示したり、リンクをクリックしたりした際に計測されるデータのことです。
初期状態で、最小限のイベントは自動的に取得してくれますので、一旦は特に設定作業を行う必要はありません。
まずはよく利用するイベントの内容を把握しましょう。
イベントのデータは、左メニューのイベントをクリックすることで確認できます。
![](24.png)

**よく利用されるイベント名とその意味を下記で紹介しますね。**

![](25.png)
詳細：[Google公式｜[GA4] 自動的に収集されるイベント](https://support.google.com/analytics/answer/9234069?hl=ja)


#### <span id="anchor_ga4_4">流入経路</span>

ユーザーがどこから訪れたのか、「サイトへの流入経路」を確認することができます。
ここでは、アクセスの流入元と、その流入元をカテゴリ別に区別して解析ができる「参照元／メディア」の確認方法をお伝えします。
まず左側メニューの「集客」をクリックし、トラフィック獲得を選択します。
![](26.png)

すると下記の画面が表示されます。

![](27.png)

参照元の種類は下記のようなものがあります。ほかにも多数ある中の一部をご紹介します。

![](28.png)
![](29.png)

#### <span id="anchor_ga4_5">サイト内行動</span>

「最初に訪れたページから他のページにどれくらい移動したのか」「他のページへ行く前に離脱したのか」などユーザーの「サイト内の行動」を確認できます。
サイト内行動は「経路分析」を作成することで確認できるので、下記のSTEPで作成していきましょう。
1. **「分析」から「分析ハブ」を選択** 左側メニューにある「分析」をクリックし分析ハブを選択します。![](30.png)
2. **「経路の分析」手法を選択** いくつか分析内容のテンプレートが表示されますが、今回は「経路分析」手法を選択します。![](31.png)
3. **「最初からやり直す」をクリック** 最初からやり直すをクリックして、計測の準備をします。![](32.png)
4. **「始点」をクリック** 始点をクリックしましょう。![](33.png)
5. **「イベント名」をクリック** イベント名をクリックしましょう。![](34.png)
6. **「session start」をクリック** 今回はブログへの訪問ごとに計測する例として、session_start（訪問回数）をクリックしましょう。![](35.png)
7. **ステップ１の「イベント名」をクリック** ステップ1の下にあるイベント名をクリックしましょう。![](36.png)
8. **「ページタイトルとスクリーン名」をクリック** ページタイトルとスクリーン名をクリックします。![](37.png)
9. **「ページタイトル」をクリックする** さらに経路が見たい場合は、ページタイトルをクリックしましょう。すると確認できる経路が増え、サイト内での訪問者の動きが確認できます。![](38.png)![](39.png)

#### <span id="anchor_ga4_6">データの設定</span>

1. 管理 ＞ データ設定 ＞ データ保持 ＞ ユーザーデータとイベントデータの保持　で期間をデフォルトの２ヶ月から、１４ヶ月に変更。![](anchor_ga4_6_1.png)
2. 管理 ＞ データ設定 ＞ データ収集 ＞ Google シグナルのデータ収集を有効にする　をONにする。![](anchor_ga4_6_2.png)
3. 管理 ＞ データ設定 ＞ データ収集 ＞ Google シグナルのデータ収集を有効にする　の下部にある『ユーザーデータ収集の確認』の確認ボタンもクリックしておきます。![](anchor_ga4_6_3.png)

#### <span id="anchor_ga4_7">タグ付けの詳細設定</span>

1. 管理 ＞ データストリーム ＞ ストリーム選択 ＞ ウェブ ストリームの詳細　＞ タグ付けの詳細設定 ＞ ドメインの設定　で 『マッチタイプ：含む or 先頭が一致』に。『ドメイン：クロスドメインにしたいドメイン』を設定。![](anchor_ga4_7_1.png)
2. 管理 ＞ データストリーム ＞ ストリーム選択 ＞ ウェブ ストリームの詳細　＞ タグ付けの詳細設定 ＞ 内部トラフィックの定義 ＞ 内部トラフィック ルールの作成　で 『ルール：わかりやすい名前』に。IPアドレスの『マッチタイプ：IPアドレスが次と等しい』『値：IPアドレス』（IPアドレスは[CMAN](https://www.cman.jp/network/support/go_access.cgi)などで確認できます。）を設定。![](anchor_ga4_7_5.png) ![](anchor_ga4_7_6.png)



## GTMの設定
  
すでにGA4が設定されている場合はタグを削除してください。

1. [GTMへアクセス](https://tagmanager.google.com/)します。
2. アカウントを作成します。![](40.png)
3. 各項目を入力してアカウントの作成は完了です。![](41.png)![](42.png)
4. **新規タグを作成** Googleタグマネージャーを開き、左メニュー項目から「タグ」を選択し、「作成」をクリックします。![](43.png)
5. **タグの名前を設定する** 「名前のないタグ」をクリックして、タグの名前を設定します。 例）GA4 – 計測タグ など ![](44.png)
6. **タグを設定** 「タグの設定」下記画像の赤枠内をクリックします。![](45.png)
7. **タグタイプ**から「Googleアナリティクス: GA4設定」を選択してください。![](46.png)
8. **「測定ID」を記入します** [**控えて**おいたID](#anchor_1)です。![](47.png)
9. **トリガーを設定** 「トリガー」下記画像の赤枠内をクリックします。![](48.png)
10. **トリガーの選択**から「All Pages」を選択します。![](49.png)
11. **タグの保存** 設定に問題がなければ右上の「保存」をクリックし、保存しましょう。![](50.png)
12. **タグが正常に動作しているか確認** タグマネージャーの「プレビュー」をクリックします。![](51.png)
13. **Tag Assistantのページにて**ウェブサイトのURLを記入し、「Connect」をクリックします。![](52.png)
14. **ウェブサイトとGoogleタグマネージャーが接続されていることを確認**し、Tag Assistant画面に戻ります。Summary内の「Tag Fired」に作成したタグが表示されていたら、正常にタグが動作しています。※タグの動作に問題がある場合「Tag Not Fired」に表示されます。![](53.png)
15. **タグを公開** 最後に作成したタグを公開します。 「公開」ボタンをクリックし、送信設定から「バージョン名」と「バージョンの説明」を記載し、もう一度「公開」をクリックします。![](54.png)

### クリックイベントを計測

1. **Googleタグマネージャーのワークスペース** から、変数を選択し、組み込み変数の設定を選択。![](55.png)
2. **組み込み変数の『クリック』** の全ての項目にチェックを入れる。![](56.png)
～各項目意味～
Click Element・・・クリックされたタグの要素
Click Classes・・・クリックされたタグのクラス属性
Click ID・・・クリックされたタグのID属性
Click Target・・・クリックされたタグのtarget属性
Click URL・・・クリックされたタグのURL
Click Text・・・クリックされたタグのテキスト（内容）
3. **『トリガー』のタブ** から『新規』をクリックし、トリガーを作成する![](57.png)
4. **『トリガー設定』** をクリックし、『トリガータイプ』の『リンクのみ』を選択![](58.png)
5. **『タグの配信を待つ』『一部のリンククリック』** を選択し、トリガーの条件を設定していく※トリガー名は『クリック』等の分かりやすいものにしておきましょう。![](59.png)
6. **『タグ』** のタブから、新規をクリック![](60.png)
7. **『トリガー』** を選択し、先ほど作成したトリガーを選択![](61.png)
8. **タグの設定** を選択し、タグタイプのGoogleアナリティクス：ユニバーサルアナリティクスを選択![](62.png)
9. **トラッキングタイプ** を『イベント』にし、イベントトラッキングパラメータ・Googleアナリティクス設定を行う。※非インタラクションヒットとは・・・直帰率に影響させるか否かを選択する設定のことです。『真』を選択する場合、直帰率に影響を与えない設定となります。反対に『偽』の場合は、直帰率に影響を与える設定となります。![](63.png)
～各設定項目～
タグ名・・・例）お問い合わせボタンクリック（推奨：分かりやすいもの）
タグタイプ・・・Google アナリティクス: ユニバーサル アナリティクス
トラッキングタイプ・・・イベント
カテゴリ・・・例)お問い合わせボタン(推奨：分かりやすいもの)
アクション・・・｛｛Click URL｝｝
ラベル・・・{{Page URL}}
このタグでオーバーライド設定を有効にする・・・チェックを入れる
トラッキングID・・・計測したいGoogle アナリティクスのIDを記入する
10. **作成したクリック計測のタグが、プレビューモードで正しく発火**しているか、確認してから公開する![](64.png)
11. **GA4で確認する** 測定したボタンのクリック数の結果を、Googleアナリティクスで確認していきます。設定したボタンのクリック数の結果は、『行動』の『イベント』で確認することができます。
また、『上位イベント』を選択し、先ほど設定したお問い合わせボタンを選択します。すると、お問い合わせボタンをクリックした数を知ることができます。![](65.png)



> 参考元：
> [**GA4でクロスドメイントラッキングを設定する方法**](https://www.terakoya.work/ga4-cross-domain-tracking-how-to/#GA4%E3%81%AE%E7%AE%A1%E7%90%86%E7%94%BB%E9%9D%A2%E8%A8%AD%E5%AE%9A)
> [【2020年最新版】GTMを使った、Google、Yahoo!、Facebook、LINE、Twitterの広告コンバージョン計測方法](https://www.kwm.co.jp/blog/cv_tag_setting2019/)
> [Googleタグマネージャー：ボタンクリックの計測方法](https://bop-com.co.jp/column/2638)
> [Googleアナリティクスのパラメータの設定方法｜手動と自動に分けて解説](https://www.gpol.co.jp/blog/107)
> [GA4とGoogle Optimizeの連携まとめ！連携可否やオススメの設定方法を解説](https://www.data-be.at/magazine/ga4-google-optimize/)
> [GTMを使用したGoogleアナリティクス4（GA4）の設定ガイド！GA4の導入方法とイベント設定方法を詳しく解説](https://www.data-be.at/magazine/ga4-gtm/)
> 
